{
  "name": "37Design - AI診断フォーム → Mautic登録",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "ai-diagnosis",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [0, 0],
      "id": "4f227964-5dcc-4712-863a-3591563c6416",
      "name": "Webhook",
      "webhookId": "d1415518-1da7-4b8b-afdf-b8d7df690502"
    },
    {
      "parameters": {
        "jsCode": "// Mautic OAuth2 Client Credentials → Create Contact + Add to Segment\nconst tokenRes = await this.helpers.httpRequest({\n  method: 'POST',\n  url: 'https://m6.37d.jp/oauth/v2/token',\n  headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n  body: 'grant_type=client_credentials&client_id=1_46bdyfromw008400kggo08oc04gogwkg04ogko48wskg0ssogo&client_secret=1vwu89kc7mw0o80gssgsk004804ok00w884c08os0884kk04cc',\n  returnFullResponse: false\n});\nconst token = tokenRes.access_token;\n\nconst body = $input.first().json.body || $input.first().json;\nconst contactData = {\n  email: body.email || '',\n  firstname: body.name || body.firstname || '',\n  company: body.company || '',\n  phone: body.phone || ''\n};\n\nlet contactId = null;\ntry {\n  const contactRes = await this.helpers.httpRequest({\n    method: 'POST',\n    url: 'https://m6.37d.jp/api/contacts/new',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: contactData,\n    returnFullResponse: false\n  });\n  contactId = contactRes?.contact?.id;\n} catch (e) {}\n\nif (contactId) {\n  try {\n    await this.helpers.httpRequest({\n      method: 'POST',\n      url: `https://m6.37d.jp/api/segments/1/contact/${contactId}/add`,\n      headers: { 'Authorization': `Bearer ${token}` },\n      returnFullResponse: false\n    });\n  } catch (e) {}\n}\n\nreturn [{ json: { success: true, message: 'OK', contactId } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [260, 0],
      "id": "mautic-code-node",
      "name": "Mautic Create Contact",
      "continueOnFail": true
    }
  ],
  "connections": {
    "Webhook": {
      "main": [[{"node": "Mautic Create Contact", "type": "main", "index": 0}]]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner"
  }
}
