---
import { getCollection } from 'astro:content';
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import "../../styles/global.css";

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const categoryColors: Record<string, string> = {
  'AI': 'bg-amber-500/10 text-amber-600',
  '業務自動化': 'bg-purple-500/10 text-purple-600',
  'マーケティング': 'bg-blue-500/10 text-blue-600',
  'CRM': 'bg-green-500/10 text-green-600',
  'お知らせ': 'bg-gray-500/10 text-gray-600',
};
---

<Layout
  title={`${post.data.title} | 株式会社37Design`}
  description={post.data.description}
>
  <Header />

  <main>
    <!-- Article Header -->
    <article class="py-16 md:py-20 bg-surface">
      <div class="max-w-4xl mx-auto px-4 md:px-6 lg:px-8">
        <!-- Breadcrumb -->
        <nav class="mb-8">
          <ol class="flex items-center gap-2 text-sm text-text-muted">
            <li><a href="/" class="hover:text-text-primary transition-colors">ホーム</a></li>
            <li>/</li>
            <li><a href="/blog" class="hover:text-text-primary transition-colors">ブログ</a></li>
            <li>/</li>
            <li class="text-text-primary">{post.data.title}</li>
          </ol>
        </nav>

        <!-- Article Meta -->
        <div class="mb-8">
          <div class="flex items-center gap-3 mb-4">
            <time class="text-sm font-semibold text-text-muted">
              {post.data.publishDate.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
            <span class={`inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ${categoryColors[post.data.category]}`}>
              {post.data.category}
            </span>
          </div>
          <h1 class="text-3xl md:text-4xl font-black text-text-primary leading-tight mb-4">
            {post.data.title}
          </h1>
          <p class="text-lg text-text-secondary leading-relaxed">
            {post.data.description}
          </p>
          <div class="mt-6 pt-6 border-t border-border">
            <p class="text-sm text-text-muted">執筆者: {post.data.author}</p>
          </div>
        </div>

        <!-- Article Content -->
        <div class="bg-white rounded-2xl p-8 md:p-12 border border-border">
          <div class="prose prose-lg max-w-none
            prose-headings:font-bold prose-headings:text-text-primary
            prose-h1:text-3xl prose-h1:mb-6
            prose-h2:text-2xl prose-h2:mt-8 prose-h2:mb-4
            prose-h3:text-xl prose-h3:mt-6 prose-h3:mb-3
            prose-p:text-text-body prose-p:leading-relaxed prose-p:mb-6
            prose-a:text-accent-600 prose-a:no-underline hover:prose-a:underline
            prose-strong:text-text-primary prose-strong:font-bold
            prose-ul:list-disc prose-ul:pl-6 prose-ul:mb-6
            prose-ol:list-decimal prose-ol:pl-6 prose-ol:mb-6
            prose-li:text-text-body prose-li:mb-2
            prose-blockquote:border-l-4 prose-blockquote:border-accent-400 prose-blockquote:pl-4 prose-blockquote:italic prose-blockquote:text-text-secondary
            prose-code:bg-surface-alt prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:text-accent-600
            prose-pre:bg-primary-950 prose-pre:text-white prose-pre:p-4 prose-pre:rounded-lg prose-pre:overflow-x-auto
          ">
            <Content />
          </div>
        </div>

        <!-- Back to Blog -->
        <div class="mt-12 text-center">
          <a
            href="/blog"
            class="inline-flex items-center gap-2 px-6 py-3 bg-surface-alt text-text-primary font-semibold rounded-full hover:bg-surface-dark transition-colors text-sm"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
            </svg>
            ブログ一覧に戻る
          </a>
        </div>
      </div>
    </article>

    <!-- CTA Section -->
    <section class="py-16 md:py-20 bg-primary-800 relative overflow-hidden">
      <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-glow/5 rounded-full blur-[120px]"></div>
        <div class="absolute bottom-0 right-1/4 w-80 h-80 bg-accent-400/5 rounded-full blur-[100px]"></div>
      </div>

      <div class="relative max-w-4xl mx-auto px-4 md:px-6 lg:px-8 text-center">
        <h2 class="text-2xl md:text-3xl font-bold text-white mb-4">
          この記事について相談してみませんか？
        </h2>
        <p class="text-white/60 text-base md:text-lg mb-8">
          無料相談で、御社に最適なソリューションをご提案します
        </p>

        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href="/contact"
            class="inline-flex items-center justify-center gap-2 px-8 py-4 bg-accent-400 text-primary-950 font-bold rounded-full hover:bg-accent-300 transition-colors text-base"
          >
            無料相談を申し込む
          </a>
          <a
            href="/service"
            class="inline-flex items-center justify-center gap-2 px-8 py-4 bg-white/10 text-white font-semibold rounded-full hover:bg-white/15 transition-colors text-base border border-white/20"
          >
            サービス一覧を見る
          </a>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>
