<!-- AI Chat Demo Widget (floating) -->
<div id="chat-widget" class="fixed bottom-6 right-6 z-50">
  <!-- Chat Button -->
  <button
    id="chat-toggle"
    class="w-14 h-14 md:w-16 md:h-16 rounded-full bg-accent-400 text-primary-950 shadow-[0_4px_16px_rgba(0,0,0,0.2)] hover:bg-accent-300 transition-all flex items-center justify-center"
    aria-label="AIアシスタントに質問する"
  >
    <svg id="chat-icon-open" class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z" />
    </svg>
    <svg id="chat-icon-close" class="w-7 h-7 hidden" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
    </svg>
  </button>

  <!-- Tooltip (shown initially) -->
  <div id="chat-tooltip" class="absolute bottom-full right-0 mb-3 bg-white rounded-xl shadow-lg px-4 py-3 w-56 border border-border">
    <p class="text-sm font-semibold text-text-primary mb-0.5">AIアシスタント</p>
    <p class="text-xs text-text-secondary">ご質問はこちらからどうぞ</p>
    <div class="absolute bottom-[-6px] right-6 w-3 h-3 bg-white border-r border-b border-border rotate-45"></div>
  </div>

  <!-- Chat Panel -->
  <div id="chat-panel" class="hidden absolute bottom-20 right-0 w-80 md:w-96 bg-white rounded-2xl shadow-[0_8px_40px_rgba(0,0,0,0.15)] border border-border overflow-hidden">
    <!-- Header -->
    <div class="bg-primary-950 px-5 py-4 flex items-center gap-3">
      <div class="w-8 h-8 rounded-full bg-accent-400 flex items-center justify-center">
        <svg class="w-4 h-4 text-primary-950" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.455 2.456L21.75 6l-1.036.259a3.375 3.375 0 0 0-2.455 2.456Z" />
        </svg>
      </div>
      <div>
        <p class="text-white text-sm font-bold">37Design AIアシスタント</p>
        <p class="text-white/50 text-[10px]">AI搭載 - 24時間対応</p>
      </div>
    </div>

    <!-- Messages -->
    <div class="p-4 h-64 overflow-y-auto flex flex-col gap-3" id="chat-messages">
      <!-- Bot message -->
      <div class="flex gap-2">
        <div class="w-6 h-6 rounded-full bg-accent-400/20 flex items-center justify-center shrink-0 mt-1">
          <svg class="w-3 h-3 text-accent-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09Z" />
          </svg>
        </div>
        <div class="bg-surface-alt rounded-xl rounded-tl-sm px-4 py-3 max-w-[80%]">
          <p class="text-sm text-text-body">こんにちは！37Design AIアシスタントです。業務自動化やAI導入について、お気軽にご質問ください。</p>
        </div>
      </div>

      <!-- Quick replies -->
      <div class="flex flex-wrap gap-2 ml-8">
        <button class="chat-quick-reply text-xs px-3 py-1.5 rounded-full border border-accent-400 text-accent-600 hover:bg-accent-400/10 transition-colors">
          どんなサービスがある？
        </button>
        <button class="chat-quick-reply text-xs px-3 py-1.5 rounded-full border border-accent-400 text-accent-600 hover:bg-accent-400/10 transition-colors">
          料金を知りたい
        </button>
        <button class="chat-quick-reply text-xs px-3 py-1.5 rounded-full border border-accent-400 text-accent-600 hover:bg-accent-400/10 transition-colors">
          導入期間は？
        </button>
      </div>
    </div>

    <!-- Input -->
    <div class="border-t border-border px-4 py-3 flex gap-2">
      <input
        type="text"
        placeholder="メッセージを入力..."
        class="flex-1 px-3 py-2 rounded-lg bg-surface-alt border border-border text-sm text-text-body placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-accent-400 focus:border-transparent"
        id="chat-input"
      />
      <button class="w-9 h-9 rounded-lg bg-accent-400 text-primary-950 flex items-center justify-center hover:bg-accent-300 transition-colors shrink-0">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
        </svg>
      </button>
    </div>

    <!-- Demo notice -->
    <div class="bg-surface-alt px-4 py-2 text-center">
      <p class="text-[10px] text-text-muted">デモ版 - 実際のAI応答は導入後にご利用いただけます</p>
    </div>
  </div>
</div>

<script>
  const toggle = document.getElementById("chat-toggle");
  const panel = document.getElementById("chat-panel");
  const tooltip = document.getElementById("chat-tooltip");
  const iconOpen = document.getElementById("chat-icon-open");
  const iconClose = document.getElementById("chat-icon-close");

  let isOpen = false;

  toggle?.addEventListener("click", () => {
    isOpen = !isOpen;
    panel?.classList.toggle("hidden", !isOpen);
    tooltip?.classList.toggle("hidden", isOpen);
    iconOpen?.classList.toggle("hidden", isOpen);
    iconClose?.classList.toggle("hidden", !isOpen);
  });

  // Hide tooltip after 5 seconds
  setTimeout(() => {
    if (!isOpen && tooltip) tooltip.classList.add("hidden");
  }, 5000);

  // Quick reply demo
  document.querySelectorAll(".chat-quick-reply").forEach((btn) => {
    btn.addEventListener("click", () => {
      const messages = document.getElementById("chat-messages");
      if (!messages) return;

      const text = btn.textContent?.trim() || "";

      // Add user message
      const userMsg = document.createElement("div");
      userMsg.className = "flex justify-end";
      userMsg.innerHTML = `<div class="bg-accent-400 rounded-xl rounded-tr-sm px-4 py-3 max-w-[80%]"><p class="text-sm text-primary-950 font-medium">${text}</p></div>`;
      messages.appendChild(userMsg);

      // Remove quick replies
      btn.parentElement?.remove();

      // Bot typing
      const typing = document.createElement("div");
      typing.className = "flex gap-2";
      typing.innerHTML = `<div class="w-6 h-6 rounded-full bg-accent-400/20 flex items-center justify-center shrink-0 mt-1"><svg class="w-3 h-3 text-accent-600 animate-spin" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182" /></svg></div><div class="bg-surface-alt rounded-xl rounded-tl-sm px-4 py-3"><p class="text-sm text-text-muted">入力中...</p></div>`;
      messages.appendChild(typing);
      messages.scrollTop = messages.scrollHeight;

      // Bot response after delay
      setTimeout(() => {
        typing.remove();
        const responses: Record<string, string> = {
          "どんなサービスがある？": "業務自動化・CRM導入・AI活用の3つのサービスを中心に提供しています。詳しくは<a href='#services' class='text-link underline'>サービスセクション</a>をご覧ください！",
          "料金を知りたい": "スターターパックは30万円〜、スタンダードは80万円〜が目安です。詳しくは<a href='#pricing' class='text-link underline'>料金プラン</a>をご確認ください。無料診断も受付中です！",
          "導入期間は？": "最短1週間で導入可能です！業務の複雑さにより2〜4週間の場合もあります。まずは<a href='#contact' class='text-link underline'>無料ヒアリング</a>でスケジュールをご提案します。",
        };
        const reply = responses[text] || "ありがとうございます！詳しくは担当者がお答えしますので、お問い合わせフォームからご連絡ください。";
        const botMsg = document.createElement("div");
        botMsg.className = "flex gap-2";
        botMsg.innerHTML = `<div class="w-6 h-6 rounded-full bg-accent-400/20 flex items-center justify-center shrink-0 mt-1"><svg class="w-3 h-3 text-accent-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09Z" /></svg></div><div class="bg-surface-alt rounded-xl rounded-tl-sm px-4 py-3 max-w-[80%]"><p class="text-sm text-text-body">${reply}</p></div>`;
        messages.appendChild(botMsg);
        messages.scrollTop = messages.scrollHeight;
      }, 1200);
    });
  });
</script>
