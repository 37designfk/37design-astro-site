---
import { getCollection } from "astro:content";

const allPosts = await getCollection("blog");
const posts = allPosts
  .sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime())
  .slice(0, 3);

const categoryColors: Record<string, string> = {
  "AI": "bg-blue-100 text-blue-700",
  "業務自動化": "bg-green-100 text-green-700",
  "マーケティング": "bg-purple-100 text-purple-700",
  "CRM": "bg-orange-100 text-orange-700",
  "SEO": "bg-teal-100 text-teal-700",
  "LP制作": "bg-pink-100 text-pink-700",
  "お知らせ": "bg-gray-100 text-gray-600",
};
---

<section class="py-16 md:py-20 bg-white">
  <div class="max-w-6xl mx-auto px-4 md:px-6 lg:px-8">
    <div class="text-center mb-10 animate-on-scroll">
      <p class="text-accent-500 text-sm font-semibold tracking-[.2em] uppercase mb-3">Blog</p>
      <h2 class="text-2xl md:text-3xl font-bold text-primary-950">
        最新<span class="marker-highlight">ブログ記事</span>
      </h2>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      {posts.map((post, i) => {
        const color = categoryColors[post.data.category] ?? "bg-gray-100 text-gray-600";
        return (
          <a
            href={`/blog/${post.slug}/`}
            class="animate-on-scroll group block rounded-xl border border-gray-100 overflow-hidden hover:shadow-lg transition-shadow duration-300"
            style={`animation-delay: ${i * 0.08}s`}
          >
            <div class="h-1 bg-gradient-to-r from-accent-400 to-accent-500"></div>
            <div class="p-5">
              <div class="flex items-center gap-2 mb-3">
                <span class={`text-[11px] font-bold px-2 py-0.5 rounded ${color}`}>
                  {post.data.category}
                </span>
                <span class="text-xs text-gray-400">
                  {new Date(post.data.publishDate).toLocaleDateString("ja-JP", { year: "numeric", month: "long", day: "numeric" })}
                </span>
              </div>
              <h3 class="text-sm font-bold text-primary-950 leading-snug mb-2 group-hover:text-accent-600 transition-colors line-clamp-2">
                {post.data.title}
              </h3>
              <p class="text-xs text-gray-500 leading-relaxed line-clamp-3">
                {post.data.description}
              </p>
            </div>
          </a>
        );
      })}
    </div>

    <div class="text-center mt-8">
      <a
        href="/blog/"
        class="inline-flex items-center gap-2 text-sm font-semibold text-primary-950 border border-primary-950 px-6 py-2.5 rounded-full hover:bg-primary-950 hover:text-white transition-colors duration-200"
      >
        記事一覧を見る
        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
        </svg>
      </a>
    </div>
  </div>
</section>
